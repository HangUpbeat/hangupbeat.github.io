---
layout: post
title: 记一次FFMPEG合并TS视频的过程
description: FFMPRG环境配置、批处理生成文本文档、使用命令合并ts
date: 2020-11-26
categories: TS视频切片 FFMPEG 视频 学习笔记
excerpt_separator: <!--more-->
---

&emsp;&emsp;别问**为什么要合并什么ts视频**，问就是**有用**。也别问合并的是什么视频。😏
&emsp;&emsp;真的是好久没这么折腾过了，懒得废话，**直接正题**。

***

<h3>下载ts文件</h3>
&emsp;&emsp;首先整理一下头绪，我是看了个视频想要下载，顺手就F12看了一眼果然是一排.ts文件。说实话，这一堆文件我大可以直接用下载工具批量下载，但人总想偷个懒，就先去找了找，看看有没有别人做的工具或者插件什么的。<font size="1">剧透警告：~~我最后还是用X雷批量下载的。~~</font>

&emsp;&emsp;度了一圈确实也找到几个软件，中间也找到个插件，这些跟着的问题就很常规，无非就是分享取消啦、链接失效啦、下载速度巨慢之类的。

&emsp;&emsp;最后成功运行的有三个软件+一个油猴插件。

&emsp;&emsp;一个是专门下载.ts文件的，一个多了合并功能，还有一个应该是最厉害的除了下载和合并，还带解密功能……但是，没有一个对我来说是管用的。

&emsp;&emsp;原因先放一边，还有个插件没说。

&emsp;&emsp;那个插件确实好使，只要视频播放就会自动搜集ts文件，最后也有合并功能。问题有二：一是音视频分离成了两个mp4文件，二是时间轴完全爆炸。就先不提用视频处理软件合并，连播放时挪进度条都成问题。所以❌。

&emsp;&emsp;回头来讲三个软件，这三个软件无论是下载还是合并都必须用到.m3u8文件，但我完全没找到我要下载视频的.m3u8文件，所以❌❌❌。说不定以后能用上，除了插件的三个软件姑且也都留了一份。

&emsp;&emsp;最后还是得自己动手，用回X雷批量下载😑，倒是也挺好用的。因为通配符，还有文件序号是从1(而不是001)开始、400多结束，分成了1~9、10~99、100~xxx三组批量下载。<font size="2">话说X雷批量下载通配符长度最多3位，所以最多就下载到第999个文件？</font>

***

<h3>下载、配置ffmpeg</h3>
&emsp;&emsp;现在，我有一整个文件夹四百多个.ts文件，直接扔进VLC里倒是也能看，但我是在看一整个视频而不是四百个抖音视频串→串↘儿而且每两个视频之间还有黑屏转场。

&emsp;&emsp;要合并起来倒也简单，在找软件的时候看见不少关于 ffmpeg 的东西。我倒是在弄清该下载哪个版本的 ffmpeg 时费了点劲。 GPL 还是 LGPL ，shared 、vlukan 还是 shared-vulkan ，一搭眼的瞬间真的迷惑至极。

&emsp;&emsp;同时我能保证说网上<font size="1">指X度</font>，80%，配置 ffmpeg 环境变量的教程给的都是同一个链接，而且是失效的。

&emsp;&emsp;最后我下的是<https://github.com/BtbN/FFmpeg-Builds/releases>里面的`ffmpeg-N-100036-g3de3d2f5e2-win64-gpl.zip`，反正最后是成功了。我猜LGPL版本应该也能成，要是想把这些东西打包在一起可能用LGPL证书后续更随意一些？ I don't really know~.

&emsp;&emsp;解压之后复制bin文件夹路径，win10 右键开始菜单-系统-高级系统设置-环境变量-(系统变量里面选中变量`path`一栏)编辑-新建，然后粘贴、确定。可以打开CMD输入ffmpeg确认一下是不是成功了。

***

<h3>合并</h3>
&emsp;&emsp;合并命令可以直接输文件名，所以我猜先要`cd`到那一堆.ts的文件夹？

``` shell
ffmpeg -i "1.ts|2.ts|3.ts|4.ts|.5.ts|" -c copy output.mp4
```

&emsp;&emsp;名字太长而且数量也多就用另一种办法，它也可以读取文本文档，确保文档格式一致，而且好像不能包含中文。

``` txt
file  'D:\tsvideo\1.ts'
file  'D:\tsvideo\2.ts'
...
file  'D:\tsvideo\404.ts'
```

&emsp;&emsp;我们当然也可以用批处理来创建这个文档：

``` bat
(for /l %%i in (1,1,404) do @echo file 'D:\tsvideo\%%i.ts') > filelist.txt
```

起始、间隔、结束、路径、ts文件名、文档名字全都改成需要、想要的

&emsp;&emsp;终于，`cd`到这个文档的目录，执行：

``` shell
ffmpeg -f concat -i filelist.txt -c copy output.mp4
```

&emsp;&emsp;注意观察提示信息有没有提示找不到文件，那应该是文档里面路径写错了，或者说是ts文件放错了地方。
&emsp;&emsp;大功告成，虽然也不是什么难事，但就是很爽。视频进度条拖起来也不需要费劲加载老半天。

***

2020-12-12
今天重新用了一次感觉问题很多，还是看看官方文档吧↓
<https://trac.ffmpeg.org/wiki/Concatenate#samecodec>
